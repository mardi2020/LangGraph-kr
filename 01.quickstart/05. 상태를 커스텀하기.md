[https://langchain-ai.github.io/langgraph/tutorials/introduction/#part-4-human-in-the-loop](https://langchain-ai.github.io/langgraph/tutorials/introduction/#part-5-customizing-state)

## Part 5: ìƒíƒœ ì»¤ìŠ¤í…€í•˜ê¸°
ì§€ê¸ˆê¹Œì§€ëŠ” ë©”ì‹œì§€ ëª©ë¡ í•˜ë‚˜ë§Œì„ í¬í•¨í•˜ëŠ” ë‹¨ìˆœí•œ ìƒíƒœì— ì˜ì¡´í•´ ì™”ìŠµë‹ˆë‹¤. ì´ì²˜ëŸ¼ ê°„ë‹¨í•œ ìƒíƒœë§Œìœ¼ë¡œë„ ë§ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì§€ë§Œ, ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸ì—ë§Œ ì˜ì¡´í•˜ì§€ ì•Šê³  ë” ë³µì¡í•œ ë™ì‘ì„ ì •ì˜í•˜ê³  ì‹¶ë‹¤ë©´ ìƒíƒœì— ì¶”ê°€ í•„ë“œë¥¼ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œëŠ” ìƒˆë¡œìš´ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì±—ë´‡ì´ **ê²€ìƒ‰ ë„êµ¬**ë¥¼ ì‚¬ìš©í•´ íŠ¹ì • ì •ë³´ë¥¼ ì°¾ì•„ë‚´ê³ , ê·¸ ê²°ê³¼ë¥¼ ì‚¬ëŒì—ê²Œ ê²€í† í•˜ê¸° ìœ„í•´ì„œ ì „ë‹¬í•˜ëŠ” ìƒí™©ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì±—ë´‡ì´ ì–´ë–¤ ì¸ë¬¼ì˜ ìƒì¼ì„ ì¡°ì‚¬í•˜ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ìƒíƒœì— `name`ê³¼ `birthday` í‚¤ë¥¼ ì¶”ê°€í•  ê²ƒì…ë‹ˆë‹¤.
``` python
from typing import Annotated

from typing_extensions import TypedDict

from langgraph.graph.message import add_messages


class State(TypedDict):
    messages: Annotated[list, add_messages]
    name: str #
    birthday: str #
```

ì´ ì •ë³´ë¥¼ ìƒíƒœì— ì¶”ê°€í•˜ë©´, ë‹¤ë¥¸ ê·¸ë˜í”„ ë…¸ë“œë“¤(ì˜ˆ: ì •ë³´ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì²˜ë¦¬í•˜ëŠ” í•˜ìœ„ ë…¸ë“œ)ë¿ë§Œ ì•„ë‹ˆë¼ ê·¸ë˜í”„ì˜ ì˜ì†ì„± ê³„ì¸µì—ì„œë„ ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

ì—¬ê¸°ì„œëŠ” `human_assistance` ë„êµ¬ ë‚´ë¶€ì—ì„œ state keyë“¤ì„ ì±„ì›Œë„£ì„ ê²ƒì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì •ë³´ê°€ ìƒíƒœì— ì €ì¥ë˜ê¸° ì „ì— ì¸ê°„ì´ ì´ë¥¼ ê²€í† í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ì´ë²ˆì—ë„ `Command`ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ë°, ì´ë²ˆì—ëŠ” ë„êµ¬ ë‚´ë¶€ì—ì„œ **ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰**í•˜ëŠ” ë°ì— ì‚¬ìš©ë©ë‹ˆë‹¤. `Command`ì˜ ë‹¤ì–‘í•œ ìœ ì¦ˆì¼€ì´ìŠ¤ì— ëŒ€í•´ì„œëŠ” [ì—¬ê¸°](https://langchain-ai.github.io/langgraph/concepts/low_level/#using-inside-tools)ì—ì„œ ë” ìì„¸íˆ ì•Œì•„ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
``` python
from langchain_core.messages import ToolMessage
from langchain_core.tools import InjectedToolCallId, tool

from langgraph.types import Command, interrupt


@tool
# ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ToolMessageë¥¼ ìƒì„±í•  ë•ŒëŠ” ì¼ë°˜ì ìœ¼ë¡œ
# í•´ë‹¹ tool callì˜ IDê°€ í•„ìš”í•˜ë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.
# LangChainì˜ InjectedToolCallIdë¥¼ ì‚¬ìš©í•˜ë©´,
# ì´ ì¸ìë¥¼ ë„êµ¬ì˜ ìŠ¤í‚¤ë§ˆì—ì„œ ëª¨ë¸ì—ê²Œ ë…¸ì¶œí•˜ì§€ ì•Šë„ë¡ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
def human_assistance(
    name: str, birthday: str, tool_call_id: Annotated[str, InjectedToolCallId]
) -> str:
    """Request assistance from a human."""
    human_response = interrupt(
        {
            "question": "Is this correct?",
            "name": name,
            "birthday": birthday,
        },
    )
    # ë§Œì•½ ì •ë³´ê°€ ì •í™•í•˜ë‹¤ë©´, ì´ì „ì˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    if human_response.get("correct", "").lower().startswith("y"):
        verified_name = name
        verified_birthday = birthday
        response = "Correct"
    # ê·¸ë ‡ì§€ ì•Šë‹¤ë©´, ì‚¬ëŒ ë¦¬ë·°ì–´ë¡œë¶€í„° ì •ë³´ë¥¼ ë°›ìŠµë‹ˆë‹¤.
    else:
        verified_name = human_response.get("name", name)
        verified_birthday = human_response.get("birthday", birthday)
        response = f"Made a correction: {human_response}"

    # íˆ´ ì•ˆì—ì„œ ToolMessageë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. 
    state_update = {
        "name": verified_name,
        "birthday": verified_birthday,
        "messages": [ToolMessage(response, tool_call_id=tool_call_id)],
    }

    # ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ íˆ´ ì•ˆì˜ Command ê°ì²´ë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.
    return Command(update=state_update)
```

ê·¸ ì™¸ì—ëŠ”, ê·¸ë˜í”„ì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ ë™ì¼í•©ë‹ˆë‹¤.
``` python
from langchain_anthropic import ChatAnthropic
from langchain_community.tools.tavily_search import TavilySearchResults

from langgraph.checkpoint.memory import MemorySaver
from langgraph.graph import StateGraph, START, END
from langgraph.prebuilt import ToolNode, tools_condition


tool = TavilySearchResults(max_results=2)
tools = [tool, human_assistance]
llm = ChatAnthropic(model="claude-3-5-sonnet-20240620")
llm_with_tools = llm.bind_tools(tools)


def chatbot(state: State):
    message = llm_with_tools.invoke(state["messages"])
    assert len(message.tool_calls) <= 1
    return {"messages": [message]}


graph_builder = StateGraph(State)
graph_builder.add_node("chatbot", chatbot)

tool_node = ToolNode(tools=tools)
graph_builder.add_node("tools", tool_node)

graph_builder.add_conditional_edges(
    "chatbot",
    tools_condition,
)
graph_builder.add_edge("tools", "chatbot")
graph_builder.add_edge(START, "chatbot")

memory = MemorySaver()
graph = graph_builder.compile(checkpointer=memory)
```

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ LangGraph ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ "birthday"ì„ ì¡°íšŒí•˜ë„ë¡ í”„ë¡¬í”„íŠ¸ë¥¼ êµ¬ì„±í•´ë´…ì‹œë‹¤. ì±—ë´‡ì´ í•„ìš”í•œ ì •ë³´ë¥¼ ì–»ì€ í›„ì—ëŠ” human_assistance toolì— ìš”ì²­ì„ ë³´ë‚´ë„ë¡ ì§€ì‹œí•  ê²ƒì…ë‹ˆë‹¤. ì´ë•Œ ë„êµ¬ì˜ ì¸ìë¡œ nameê³¼ birthdayë¥¼ ì„¤ì •í•¨ìœ¼ë¡œì¨, ì±—ë´‡ì´ ì´ í•„ë“œì— ëŒ€í•œ ì œì•ˆì„ ìƒì„±í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.
``` python
user_input = (
    "Can you look up when LangGraph was released? "
    "When you have the answer, use the human_assistance tool for review."
)
config = {"configurable": {"thread_id": "1"}}

events = graph.stream(
    {"messages": [{"role": "user", "content": user_input}]},
    config,
    stream_mode="values",
)
for event in events:
    if "messages" in event:
        event["messages"][-1].pretty_print()
```
```
================================[1m Human Message [0m=================================

Can you look up when LangGraph was released? When you have the answer, use the human_assistance tool for review.
==================================[1m Ai Message [0m==================================

[{'text': "Certainly! I'll start by searching for information about LangGraph's release date using the Tavily search function. Then, I'll use the human_assistance tool for review.", 'type': 'text'}, {'id': 'toolu_01JoXQPgTVJXiuma8xMVwqAi', 'input': {'query': 'LangGraph release date'}, 'name': 'tavily_search_results_json', 'type': 'tool_use'}]
Tool Calls:
  tavily_search_results_json (toolu_01JoXQPgTVJXiuma8xMVwqAi)
 Call ID: toolu_01JoXQPgTVJXiuma8xMVwqAi
  Args:
    query: LangGraph release date
=================================[1m Tool Message [0m=================================
Name: tavily_search_results_json

[{"url": "https://blog.langchain.dev/langgraph-cloud/", "content": "We also have a new stable release of LangGraph. By LangChain 6 min read Jun 27, 2024 (Oct '24) Edit: Since the launch of LangGraph Cloud, we now have multiple deployment options alongside LangGraph Studio - which now fall under LangGraph Platform. LangGraph Cloud is synonymous with our Cloud SaaS deployment option."}, {"url": "https://changelog.langchain.com/announcements/langgraph-cloud-deploy-at-scale-monitor-carefully-iterate-boldly", "content": "LangChain - Changelog | â˜ ğŸš€ LangGraph Cloud: Deploy at scale, monitor LangChain LangSmith LangGraph LangChain LangSmith LangGraph LangChain LangSmith LangGraph LangChain Changelog Sign up for our newsletter to stay up to date DATE: The LangChain Team LangGraph LangGraph Cloud â˜ ğŸš€ LangGraph Cloud: Deploy at scale, monitor carefully, iterate boldly DATE: June 27, 2024 AUTHOR: The LangChain Team LangGraph Cloud is now in closed beta, offering scalable, fault-tolerant deployment for LangGraph agents. LangGraph Cloud also includes a new playground-like studio for debugging agent failure modes and quick iteration: Join the waitlist today for LangGraph Cloud. And to learn more, read our blog post announcement or check out our docs. Subscribe By clicking subscribe, you accept our privacy policy and terms and conditions."}]
==================================[1m Ai Message [0m==================================

[{'text': "Based on the search results, it appears that LangGraph was already in existence before June 27, 2024, when LangGraph Cloud was announced. However, the search results don't provide a specific release date for the original LangGraph. \n\nGiven this information, I'll use the human_assistance tool to review and potentially provide more accurate information about LangGraph's initial release date.", 'type': 'text'}, {'id': 'toolu_01JDQAV7nPqMkHHhNs3j3XoN', 'input': {'name': 'Assistant', 'birthday': '2023-01-01'}, 'name': 'human_assistance', 'type': 'tool_use'}]
Tool Calls:
  human_assistance (toolu_01JDQAV7nPqMkHHhNs3j3XoN)
 Call ID: toolu_01JDQAV7nPqMkHHhNs3j3XoN
  Args:
    name: Assistant
    birthday: 2023-01-01
```
ìš°ë¦¬ëŠ” `human_assistance` ë„êµ¬ì—ì„œ ë‹¤ì‹œ `interrupt`ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°ì—ëŠ” ì±—ë´‡ì´ ì •í™•í•œ ë‚ ì§œë¥¼ ì‹ë³„í•˜ì§€ ëª»í–ˆê¸° ë•Œë¬¸ì—, ìš°ë¦¬ê°€ ê·¸ ë‚ ì§œë¥¼ ì œê³µí•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
``` python
human_command = Command(
    resume={
        "name": "LangGraph",
        "birthday": "Jan 17, 2024",
    },
)

events = graph.stream(human_command, config, stream_mode="values")
for event in events:
    if "messages" in event:
        event["messages"][-1].pretty_print()
```
```
==================================[1m Ai Message [0m==================================

[{'text': "Based on the search results, it appears that LangGraph was already in existence before June 27, 2024, when LangGraph Cloud was announced. However, the search results don't provide a specific release date for the original LangGraph. \n\nGiven this information, I'll use the human_assistance tool to review and potentially provide more accurate information about LangGraph's initial release date.", 'type': 'text'}, {'id': 'toolu_01JDQAV7nPqMkHHhNs3j3XoN', 'input': {'name': 'Assistant', 'birthday': '2023-01-01'}, 'name': 'human_assistance', 'type': 'tool_use'}]
Tool Calls:
  human_assistance (toolu_01JDQAV7nPqMkHHhNs3j3XoN)
 Call ID: toolu_01JDQAV7nPqMkHHhNs3j3XoN
  Args:
    name: Assistant
    birthday: 2023-01-01
=================================[1m Tool Message [0m=================================
Name: human_assistance

Made a correction: {'name': 'LangGraph', 'birthday': 'Jan 17, 2024'}
==================================[1m Ai Message [0m==================================

Thank you for the human assistance. I can now provide you with the correct information about LangGraph's release date.

LangGraph was initially released on January 17, 2024. This information comes from the human assistance correction, which is more accurate than the search results I initially found.

To summarize:
1. LangGraph's original release date: January 17, 2024
2. LangGraph Cloud announcement: June 27, 2024

It's worth noting that LangGraph had been in development and use for some time before the LangGraph Cloud announcement, but the official initial release of LangGraph itself was on January 17, 2024.
```
